// Copyright 2017 syzkaller project authors. All rights reserved.
// Use of this source code is governed by Apache 2 LICENSE that can be found in the LICENSE file.

#define ADDR_TEXT 0x0000
#define ADDR_GDT 0x1000
#define ADDR_LDT 0x1800
#define ADDR_PML4 0x2000
#define ADDR_PDP 0x3000
#define ADDR_PD 0x4000
#define ADDR_STACK0 0x0f80
#define ADDR_VAR_HLT 0x2800
#define ADDR_VAR_SYSRET 0x2808
#define ADDR_VAR_SYSEXIT 0x2810
#define ADDR_VAR_IDT 0x3800
#define ADDR_VAR_TSS64 0x3a00
#define ADDR_VAR_TSS64_CPL3 0x3c00
#define ADDR_VAR_TSS16 0x3d00
#define ADDR_VAR_TSS16_2 0x3e00
#define ADDR_VAR_TSS16_CPL3 0x3f00
#define ADDR_VAR_TSS32 0x4800
#define ADDR_VAR_TSS32_2 0x4a00
#define ADDR_VAR_TSS32_CPL3 0x4c00
#define ADDR_VAR_TSS32_VM86 0x4e00
#define ADDR_VAR_VMXON_PTR 0x5f00
#define ADDR_VAR_VMCS_PTR 0x5f08
#define ADDR_VAR_VMEXIT_PTR 0x5f10
#define ADDR_VAR_VMWRITE_FLD 0x5f18
#define ADDR_VAR_VMWRITE_VAL 0x5f20
#define ADDR_VAR_VMXON 0x6000
#define ADDR_VAR_VMCS 0x7000
#define ADDR_VAR_VMEXIT_CODE 0x9000
#define ADDR_VAR_USER_CODE 0x9100
#define ADDR_VAR_USER_CODE2 0x9120

#define SEL_LDT (1 << 3)
#define SEL_CS16 (2 << 3)
#define SEL_DS16 (3 << 3)
#define SEL_CS16_CPL3 ((4 << 3) + 3)
#define SEL_DS16_CPL3 ((5 << 3) + 3)
#define SEL_CS32 (6 << 3)
#define SEL_DS32 (7 << 3)
#define SEL_CS32_CPL3 ((8 << 3) + 3)
#define SEL_DS32_CPL3 ((9 << 3) + 3)
#define SEL_CS64 (10 << 3)
#define SEL_DS64 (11 << 3)
#define SEL_CS64_CPL3 ((12 << 3) + 3)
#define SEL_DS64_CPL3 ((13 << 3) + 3)
#define SEL_CGATE16 (14 << 3)
#define SEL_TGATE16 (15 << 3)
#define SEL_CGATE32 (16 << 3)
#define SEL_TGATE32 (17 << 3)
#define SEL_CGATE64 (18 << 3)
#define SEL_CGATE64_HI (19 << 3)
#define SEL_TSS16 (20 << 3)
#define SEL_TSS16_2 (21 << 3)
#define SEL_TSS16_CPL3 ((22 << 3) + 3)
#define SEL_TSS32 (23 << 3)
#define SEL_TSS32_2 (24 << 3)
#define SEL_TSS32_CPL3 ((25 << 3) + 3)
#define SEL_TSS32_VM86 (26 << 3)
#define SEL_TSS64 (27 << 3)
#define SEL_TSS64_HI (28 << 3)
#define SEL_TSS64_CPL3 ((29 << 3) + 3)
#define SEL_TSS64_CPL3_HI (30 << 3)

#define MSR_IA32_FEATURE_CONTROL 0x3a
#define MSR_IA32_VMX_BASIC 0x480
#define MSR_IA32_SMBASE 0x9e
#define MSR_IA32_SYSENTER_CS 0x174
#define MSR_IA32_SYSENTER_ESP 0x175
#define MSR_IA32_SYSENTER_EIP 0x176
#define MSR_IA32_STAR 0xC0000081
#define MSR_IA32_LSTAR 0xC0000082
#define MSR_IA32_VMX_PROCBASED_CTLS2 0x48B

#define NEXT_INSN $0xbadc0de
#define PREFIX_SIZE 0xba1d

#define PIN_BASED_VM_EXECUTION_CONTROLS 0x00004000
#define PRIMARY_PROCESSOR_BASED_VM_EXECUTION_CONTROLS 0x00004002
#define SECONDARY_PROCESSOR_BASED_VM_EXECUTION_CONTROLS 0x0000401E
#define VM_EXIT_CONTROLS 0x0000400C
#define VM_ENTRY_CONTROLS 0x00004012
#define HOST_IA32_PERF_GLOBAL_CTRL_FULL 0x00002C04
#define VMCS_LINK_POINTER_FULL 0x00002800
#define HOST_CS_SELECTOR 0x00000C02
#define HOST_ES_SELECTOR 0x00000C00
#define HOST_SS_SELECTOR 0x00000C04
#define HOST_DS_SELECTOR 0x00000C06
#define HOST_FS_SELECTOR 0x00000C08
#define HOST_GS_SELECTOR 0x00000C0A
#define HOST_TR_SELECTOR 0x00000C0C
#define HOST_IA32_EFER_FULL 0x00002C02
#define HOST_IA32_SYSENTER_CS 0x00004C00
#define HOST_IA32_SYSENTER_ESP 0x00006C10
#define HOST_IA32_SYSENTER_EIP 0x00006C12
#define HOST_CR0 0x00006C00
#define HOST_CR3 0x00006C02
#define HOST_CR4 0x00006C04
#define HOST_FS_BASE 0x00006C06
#define HOST_GS_BASE 0x00006C08
#define HOST_TR_BASE 0x00006C0A
#define HOST_GDTR_BASE 0x00006C0C
#define HOST_IDTR_BASE 0x00006C0E
#define HOST_RSP 0x00006C14
#define HOST_RIP 0x00006C16
#define VPID 0x00000000
#define POSTED_INTERRUPT_NOTIFICATION_VECTOR 0x00000002
#define EPTP_INDEX 0x00000004
#define ADDRESS_OF_IO_BITMAP_A_FULL 0x00002000
#define ADDRESS_OF_IO_BITMAP_B_FULL 0x00002002
#define ADDRESS_OF_MSR_BITMAPS_FULL 0x00002004
#define VM_EXIT_MSR_STORE_ADDRESS_FULL 0x00002006
#define HOST_IA32_PAT_FULL 0x00002C00
#define EXCEPTION_BITMAP 0x00004004
#define CR3_TARGET_COUNT 0x0000400A
#define VM_EXIT_MSR_STORE_COUNT 0x0000400E
#define VM_EXIT_MSR_LOAD_COUNT 0x00004010
#define VM_ENTRY_INTERRUPTION_INFORMATION_FIELD 0x00004016
#define VM_ENTRY_MSR_LOAD_COUNT 0x00004014
#define CR0_GUEST_HOST_MASK 0x00006000
#define CR4_GUEST_HOST_MASK 0x00006002
#define EOI_EXIT_BITMAP_0 0x0000201C
#define EOI_EXIT_BITMAP_1 0x0000201E
#define EOI_EXIT_BITMAP_2 0x00002020
#define EOI_EXIT_BITMAP_3 0x00002022
#define GUEST_ES_SELECTOR 0x00000800
#define GUEST_CS_SELECTOR 0x00000802
#define GUEST_SS_SELECTOR 0x00000804
#define GUEST_DS_SELECTOR 0x00000806
#define GUEST_FS_SELECTOR 0x00000808
#define GUEST_GS_SELECTOR 0x0000080A
#define GUEST_LDTR_SELECTOR 0x0000080C
#define GUEST_TR_SELECTOR 0x0000080E
#define GUEST_LDTR_BASE 0x00006812
#define GUEST_TR_BASE 0x00006814
#define GUEST_GDTR_BASE 0x00006816
#define GUEST_IDTR_BASE 0x00006818
#define GUEST_ES_LIMIT 0x00004800
#define GUEST_CS_LIMIT 0x00004802
#define GUEST_SS_LIMIT 0x00004804
#define GUEST_DS_LIMIT 0x00004806
#define GUEST_FS_LIMIT 0x00004808
#define GUEST_GS_LIMIT 0x0000480A
#define GUEST_LDTR_LIMIT 0x0000480C
#define GUEST_TR_LIMIT 0x0000480E
#define GUEST_GDTR_LIMIT 0x00004810
#define GUEST_IDTR_LIMIT 0x00004812
#define GUEST_ES_ACCESS_RIGHTS 0x00004814
#define GUEST_CS_ACCESS_RIGHTS 0x00004816
#define GUEST_SS_ACCESS_RIGHTS 0x00004818
#define GUEST_DS_ACCESS_RIGHTS 0x0000481A
#define GUEST_FS_ACCESS_RIGHTS 0x0000481C
#define GUEST_GS_ACCESS_RIGHTS 0x0000481E
#define GUEST_LDTR_ACCESS_RIGHTS 0x00004820
#define GUEST_TR_ACCESS_RIGHTS 0x00004822
#define GUEST_RSP 0x0000681C
#define GUEST_RIP 0x0000681E
#define GUEST_RFLAGS 0x00006820
#define GUEST_IA32_EFER_FULL 0x00002806
#define GUEST_PDPTE0_FULL 0x0000280A
#define GUEST_PDPTE1_FULL 0x0000280C
#define GUEST_PDPTE2_FULL 0x0000280E
#define GUEST_PDPTE3_FULL 0x00002810
#define GUEST_CR0 0x00006800
#define GUEST_CR3 0x00006802
#define GUEST_CR4 0x00006804
#define IA32_VMX_PINBASED_CTLS 0x481
#define IA32_VMX_PROCBASED_CTLS 0x482
#define IA32_VMX_EXIT_CTLS 0x483
#define IA32_VMX_ENTRY_CTLS 0x484
#define VM_INSTRUCTION_ERROR 0x00004400
#define EXIT_REASON 0x00004402
#define EXIT_QUALIFICATION 0x00006400